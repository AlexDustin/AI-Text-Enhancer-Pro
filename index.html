<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Editor Pro v3.0</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Styles & Libs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.9/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Diff Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>

    <!-- Top Toolbar -->
    <div class="toolbar">
        <div style="display: flex; align-items: center; gap: 6px;">
            <span class="toolbar-label">–ú–æ–¥–µ–ª—å</span>
            <div style="display: flex; gap: 4px;">
                <select id="modelSelect" style="width: 180px;"></select>
                <button class="btn" id="manageModelsBtn" title="Manage Models" style="padding: 0 8px;">‚öôÔ∏è</button>
            </div>
        </div>
        <div class="divider"></div>
        <div>
            <span class="toolbar-label">–ü—Ä–æ–º–ø—Ç</span>
            <select id="promptSelect" style="min-width: 150px;"></select>
        </div>
        <button class="btn" id="managePromptsBtn">‚öôÔ∏è</button>
        <div class="divider"></div>
        
        <button class="btn btn-primary" id="sendBtn">
            <span id="sendBtnText">Run Processor</span>
            <span style="font-size:10px; opacity:0.7; margin-left:4px;">(Ctrl+Enter)</span>
        </button>

        <!-- –õ–û–ì–û–¢–ò–ü -->
        <div class="app-logo">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L14.5 7.5L20 10L14.5 12.5L12 18L9.5 12.5L4 10L9.5 7.5L12 2Z"/>
            </svg>
            <span class="app-logo-text">AI Text Enhancer <span class="app-logo-pro">Pro</span></span>
        </div>
        
        <div class="btn-group">
            <button class="btn-group-item active" id="viewPreviewBtn">Preview</button>
            <button class="btn-group-item" id="viewDiffBtn">Diff</button>
        </div>

        <button class="btn" id="apiKeyBtn" title="API Key Settings">üîë Key</button>
        <div class="divider"></div>

        <div class="divider"></div>
        <button class="btn" id="swapBtn">‚áÑ Swap</button>
        <button class="btn" id="clearBtn" style="margin-left: 6px;" title="Reset Workspace">üóëÔ∏è Clear</button>
        <div class="divider"></div>
        
        <div>
            <span class="toolbar-label">–í–∏–¥</span>
            <select id="fontSelect">
                <option value="'Inter', -apple-system, sans-serif">Inter (UI)</option>
                <option value="charter, Georgia, serif">Charter (Serif)</option>
                <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
            </select>
            <select id="fontSizeSelect" style="width: 70px;">
                <option value="14">14px</option>
                <option value="15" selected>15px</option>
                <option value="16">16px</option>
                <option value="18">18px</option>
            </select>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-container">
        <!-- Left Panel: Input -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">INPUT</span>
                <div class="panel-tools">
                    <span class="char-counter" id="inputCounter">0 chars</span>
                </div>
            </div>
            
            <!-- X-Ray System Prompt Panel -->
            <div class="sys-prompt-bar" id="sysBar">
                <div class="sys-header" id="sysHeader">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span id="sysArrow" style="font-size:10px; transition:0.2s;">‚ñ∂</span>
                        <span style="font-weight: 600; font-size: 11px;">System Prompt</span>
                        
                        <!-- –í–ê–ñ–ù–û: –í–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–≤—É–º—è –±–µ–π–¥–∂–∞–º–∏ -->
                        <div style="display:flex; gap: 4px;">
                            <span id="sysNameBadge" class="sys-badge">...</span>
                            <span id="sysStatus" class="sys-badge">ORIGINAL</span>
                        </div>
                    </div>
                    <button class="btn-sys-reset" id="sysResetBtn" title="Revert to original file content">‚Ü∫ Revert</button>
                </div>
                <div class="sys-body" id="sysBody">
                    <textarea id="sysEditor" spellcheck="false"></textarea>
                </div>
            </div>

            <div class="editor-container">
                <textarea id="inputText" placeholder="Paste your text here..."></textarea>
            </div>
        </div>

        <!-- Right Panel: Output -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">OUTPUT</span>
                <div class="panel-tools">
                    <span class="char-counter" id="outputCounter">0 chars</span>
                    
                </div>
            </div>
            <!-- Output Actions Bar (Symmetry Fix) -->
            <div class="sys-prompt-bar">
                <div class="sys-header" style="cursor: default; justify-content: flex-end;">
                    <div style="display:flex; align-items:center; gap:8px;">
                        
                        <button class="btn-sys-reset visible" id="copyBtn" title="Copy Output">
                            <span>üìã</span> Copy Text
                        </button>
                    </div>
                </div>
            </div>
            <div class="editor-container" style="background: #0d1117;">
                <textarea id="outputText" style="display: none;"></textarea>
                <div class="rich-output" id="richOutput">
                    <div style="color: var(--text-muted); display: flex; height: 100%; align-items: center; justify-content: center; flex-direction: column; gap: 10px;">
                        <div style="font-size: 40px; opacity: 0.2;">‚å®Ô∏è</div>
                        <div>Ready to process</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar" id="statusBar">
        <div style="display: flex; align-items: center;">
            <span class="status-indicator"></span>
            <span id="statusText">Ready</span>
            <span style="margin-left: 16px; padding-left: 16px; border-left: 1px solid var(--border); opacity: 0.8;">
                <span class="stats-label">Default:</span>
                <span id="statsDefault" style="color: var(--text-main); font-weight: 600;">...</span>
            </span>
            <span style="margin-left: 16px; padding-left: 16px; border-left: 1px solid var(--border); opacity: 0.8;">
                <span class="stats-label">Def. Prompt:</span>
                <span id="statsDefaultPrompt" style="color: var(--text-main); font-weight: 600;">...</span>
            </span>
        </div>
        <div style="display: flex; align-items: center;">
            <span class="stats-item"><span class="stats-label">Tokens:</span><span id="statsTokens">0</span></span>
            <span class="stats-item"><span class="stats-label">Est. Cost:</span><span id="statsCost">$0.000</span></span>
            <span class="stats-item" style="margin-left:20px;" id="statusTime"></span>
        </div>
    </div>

    <!-- Prompts Modal -->
    <div class="modal-overlay" id="promptModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Prompt Library</span>
                <button class="btn btn-icon-only" id="closeModalBtn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="prompt-sidebar" id="promptList"></div>
                <div class="prompt-preview-area">
                    <textarea id="promptPreview" readonly class="prompt-text-display"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Models Manager Modal -->
    <div class="modal-overlay" id="modelsModal">
        <div class="modal" style="width: 600px; height: auto; max-height: 80vh;">
            <div class="modal-header">
                <span class="modal-title">Model Manager (OpenRouter)</span>
                <button class="btn btn-icon-only" id="closeModelsBtn">‚úï</button>
            </div>
            <div class="modal-body" style="flex-direction: column; padding: 16px; gap: 16px; overflow-y: auto;">
                <div style="display: flex; gap: 8px; align-items: flex-end; background: rgba(255,255,255,0.03); padding: 12px; border-radius: 6px; border: 1px solid var(--border);">
                    <div style="flex: 1;">
                        <div class="toolbar-label" style="margin-bottom: 4px;">Model ID (OpenRouter)</div>
                        <input type="text" id="newModelId" placeholder="e.g. google/gemini-pro" style="width: 100%; background: var(--bg-input); border: 1px solid var(--border); color: var(--text-main); padding: 6px; border-radius: 4px; outline: none;">
                    </div>
                    <div style="flex: 1;">
                        <div class="toolbar-label" style="margin-bottom: 4px;">Display Name</div>
                        <input type="text" id="newModelName" placeholder="e.g. Gemini Pro" style="width: 100%; background: var(--bg-input); border: 1px solid var(--border); color: var(--text-main); padding: 6px; border-radius: 4px; outline: none;">
                    </div>
                    <button class="btn btn-primary" id="addModelBtn" style="height: 30px;">Add</button>
                </div>
                <div class="toolbar-label">Saved Models</div>
                <div id="modelsList" style="display: flex; flex-direction: column; gap: 6px;"></div>
                <div style="margin-top: 8px; text-align: right;">
                    <button class="btn" id="resetModelsBtn" style="font-size: 11px; opacity: 0.7;">Reset to Defaults</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Key Modal -->
    <div class="modal-overlay" id="apiKeyModal">
        <div class="modal" style="width: 500px; height: auto;">
            <div class="modal-header">
                <span class="modal-title">OpenRouter API Key Configuration</span>
                <button class="btn btn-icon-only" id="closeKeyModalBtn">‚úï</button>
            </div>
            <div class="modal-body" style="flex-direction: column; padding: 20px;">
                <div id="keyStatusMsg" class="key-status-msg" style="display:none;"></div>
                <div class="toolbar-label" style="margin-bottom: 6px;">API Key</div>
                <div class="key-input-group">
                    <div class="key-input-wrapper">
                        <input type="password" id="apiKeyInput" placeholder="sk-or-v1-...">
                        <button class="input-icon-btn btn-copy-key" id="copyKeyBtn" title="Copy to Clipboard">üìã</button>
                        <button class="input-icon-btn btn-eye" id="toggleKeyVisBtn" title="Show/Hide">üëÅÔ∏è</button>
                    </div>
                    <button class="btn btn-primary" id="saveKeyBtn">Save</button>
                </div>
                <div style="font-size: 12px; color: var(--text-muted); line-height: 1.5; margin-top: 12px;">
                    <div style="margin-bottom: 4px; color: var(--success);">üîí <strong>Secure Storage Active</strong></div>
                    Key is encrypted locally using <strong>AES-128 (Fernet)</strong> and saved to <code style="background:rgba(255,255,255,0.1); padding:2px 4px; border-radius:4px; font-family:'JetBrains Mono';">api_key.bin</code>.
                    <br>The server reads strictly from this encrypted file.
                </div>
                <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border); text-align: right;">
                    <button class="btn" id="deleteKeyBtn" style="color: #da3633; border-color: rgba(218, 54, 51, 0.3);">Remove Key</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Logic -->
    <script src="static/main.js"></script>
</body>
</html>